<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Caprock Livestock Bidding Board</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="text-center mb-4">Caprock Livestock Bidding Board</h1>

    <div class="card mb-4 p-3">
      <h4>Create New Lot</h4>
      <input id="lotTitle" class="form-control mb-2" placeholder="Lot Title">
      <input id="lotPedigree" class="form-control mb-2" placeholder="Pedigree">
      <textarea id="lotDescription" class="form-control mb-2" placeholder="Description"></textarea>
      <input id="lotBreed" class="form-control mb-2" placeholder="Breed">
      <input id="lotStartPrice" type="number" class="form-control mb-2" placeholder="Starting Price">
      <input id="lotIncrement" type="number" class="form-control mb-2" placeholder="Bid Increment">
      <input id="lotImage" type="file" class="form-control mb-2">
      <button id="addLotBtn" class="btn btn-primary w-100">Add Lot</button>
    </div>

    <div id="lotsContainer" class="row g-3"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCquC_ZsPf59yGnlFLzK8Du1mgibvKOK_M",
      authDomain: "biddingapp-a6d8e.firebaseapp.com",
      projectId: "biddingapp-a6d8e",
      storageBucket: "biddingapp-a6d8e.firebasestorage.app",
      messagingSenderId: "870014358891",
      appId: "1:870014358891:web:b74cf577dfd38eff46e82e",
      measurementId: "G-0QWG9DQCLG"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const lotsRef = collection(db, 'lots');

    // Add a new lot
    document.getElementById('addLotBtn').addEventListener('click', async () => {
      const title = document.getElementById('lotTitle').value.trim();
      const pedigree = document.getElementById('lotPedigree').value.trim();
      const description = document.getElementById('lotDescription').value.trim();
      const breed = document.getElementById('lotBreed').value.trim();
      const startPrice = parseFloat(document.getElementById('lotStartPrice').value);
      const increment = parseFloat(document.getElementById('lotIncrement').value);
      const file = document.getElementById('lotImage').files[0];

      if (!title || !startPrice || !increment || !file) {
        alert('Please fill out all required fields.');
        return;
      }

      try {
        const storageRef = ref(storage, `lot-images/${Date.now()}_${file.name}`);
        await uploadBytes(storageRef, file);
        const imageUrl = await getDownloadURL(storageRef);

        await addDoc(lotsRef, {
          title, pedigree, description, breed, startPrice, increment,
          currentBid: startPrice, imageUrl, timestamp: serverTimestamp()
        });

        document.querySelectorAll('input, textarea').forEach(el => el.value = '');
        alert('Lot added successfully!');
      } catch (e) {
        console.error('Error adding lot:', e);
        alert('Error adding lot. Check console.');
      }
    });

    // Live listener for lots
    const q = query(lotsRef, orderBy('timestamp', 'desc'));
    onSnapshot(q, (snapshot) => {
      const lotsContainer = document.getElementById('lotsContainer');
      lotsContainer.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const card = document.createEl
