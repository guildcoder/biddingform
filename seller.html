<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seller Portal - Caprock Livestock</title>
<style>
body { font-family:'Oswald', sans-serif; background:#0D1B2A; color:#F7F2EC; margin:0; padding:0; }
header { padding:20px; text-align:center; background:#8A1E1E; font-size:2rem; }
.container { max-width:800px; margin:auto; padding:20px; }
input, select, button { display:block; margin-bottom:15px; padding:10px; border-radius:10px; border:none; width:100%; }
button { background:#8A1E1E; color:#F7F2EC; cursor:pointer; }
button:hover { background:#B22222; }
.lot-preview { margin-bottom:20px; }
.lot-preview img { width:100%; max-width:300px; border-radius:10px; }
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
</head>
<body>
<header>Seller Portal</header>
<div class="container">
    <h2>Add New Lot</h2>
    <input type="text" id="lotTitle" placeholder="Lot # | Ear Notch">
    <input type="text" id="pedigree" placeholder="Pedigree">
    <input type="text" id="breed" placeholder="Breed">
    <input type="number" id="startPrice" placeholder="Starting Bid Price">
    <input type="number" id="bidIncrement" placeholder="Bid Increment ($)">
    <input type="file" id="lotImage">
    <div class="lot-preview" id="lotPreview"></div>
    <button id="addLotBtn">Add Lot</button>
    <p id="statusMsg"></p>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCquC_ZsPf59yGnlFLzK8Du1mgibvKOK_M",
    authDomain: "biddingapp-a6d8e.firebaseapp.com",
    projectId: "biddingapp-a6d8e",
    storageBucket: "biddingapp-a6d8e.firebasestorage.app",
    messagingSenderId: "870014358891",
    appId: "1:870014358891:web:b74cf577dfd38eff46e82e",
    measurementId: "G-0QWG9DQCLG"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

const lotTitleInput = document.getElementById("lotTitle");
const pedigreeInput = document.getElementById("pedigree");
const breedInput = document.getElementById("breed");
const startPriceInput = document.getElementById("startPrice");
const bidIncrementInput = document.getElementById("bidIncrement");
const lotImageInput = document.getElementById("lotImage");
const lotPreview = document.getElementById("lotPreview");
const addLotBtn = document.getElementById("addLotBtn");
const statusMsg = document.getElementById("statusMsg");

// Preview image before upload
lotImageInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
        lotPreview.innerHTML = `<img src="${reader.result}" alt="Lot Image">`;
    };
    reader.readAsDataURL(file);
});

// Add Lot to Firestore + Storage
addLotBtn.addEventListener("click", async () => {
    const title = lotTitleInput.value.trim();
    const pedigree = pedigreeInput.value.trim();
    const breed = breedInput.value.trim();
    const startPrice = Number(startPriceInput.value);
    const bidIncrement = Number(bidIncrementInput.value);
    const file = lotImageInput.files[0];

    if (!title || !startPrice || !bidIncrement) {
        statusMsg.textContent = "Please fill all required fields.";
        return;
    }

    try {
        let imageURL = "";
        if (file) {
            const storageRef = storage.ref().child(`lots/${Date.now()}_${file.name}`);
            await storageRef.put(file);
            imageURL = await storageRef.getDownloadURL();
        }

        await db.collection("sales").doc("demoSale").collection("lots").add({
            title,
            pedigree,
            breed,
            startPrice,
            bidIncrement,
            currentBid: null,
            currentBidder: null,
            imageURL: imageURL || ""
        });

        statusMsg.textContent = "Lot added successfully!";
        lotTitleInput.value = "";
        pedigreeInput.value = "";
        breedInput.value = "";
        startPriceInput.value = "";
        bidIncrementInput.value = "";
        lotImageInput.value = "";
        lotPreview.innerHTML = "";
    } catch (err) {
        console.error(err);
        statusMsg.textContent = "Error adding lot.";
    }
});
</script>
</body>
</html>
