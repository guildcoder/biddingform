<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Caprock — Admin</title>
<style>
body{font-family:Inter,system-ui;padding:24px;background:#f3f2ef;color:#041029}
.card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-top:12px}
.input{padding:8px;border-radius:8px;border:1px solid #eaeaea}
.btn{padding:8px 12px;border-radius:8px;border:0;background:#041029;color:#fff;cursor:pointer}
.small{font-size:13px;color:#666}
.table{width:100%;border-collapse:collapse;margin-top:8px}
.table td,.table th{padding:8px;border-bottom:1px solid #f1f1f1}
</style>
</head>
<body>
<h2>Admin — Entry Codes (requires PIN)</h2>
<div id="pinArea" class="card">
  <div class="small">Enter admin PIN to continue.</div>
  <input id="pin" class="input" placeholder="PIN" />
  <button id="pinBtn" class="btn">Enter</button>
  <div id="pinMsg" class="small"></div>
</div>

<div id="adminUI" style="display:none">
  <div class="card">
    <div style="display:flex;gap:8px;align-items:center">
      <input id="sellerId" class="input" placeholder="sellerId (internal id)" />
      <input id="codeValue" class="input" placeholder="Entry Code (optional random)" />
      <button id="createCode" class="btn">Create Entry Code</button>
    </div>
    <div class="small">Entry codes are temporary numbers you can give to sellers so they can access the sale builder.</div>
  </div>

  <div class="card">
    <h3>Active Entry Codes</h3>
    <table class="table" id="codesTable"><thead><tr><th>Code</th><th>SellerId</th><th>Created</th><th>Actions</th></tr></thead><tbody></tbody></table>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCquC_ZsPf59yGnlFLzK8Du1mgibvKOK_M",
  authDomain: "biddingapp-a6d8e.firebaseapp.com",
  projectId: "biddingapp-a6d8e",
  storageBucket: "biddingapp-a6d8e.firebasestorage.app",
  messagingSenderId: "870014358891",
  appId: "1:870014358891:web:b74cf577dfd38eff46e82e",
  measurementId: "G-0QWG9DQCLG"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

document.getElementById('pinBtn').onclick = ()=>{
  const pin = document.getElementById('pin').value.trim();
  if(pin === 'KW1912'){ document.getElementById('pinArea').style.display='none'; document.getElementById('adminUI').style.display='block'; loadCodes(); }
  else document.getElementById('pinMsg').textContent='Wrong PIN.';
};

document.getElementById('createCode').onclick = async ()=>{
  const sellerId = document.getElementById('sellerId').value.trim();
  let code = document.getElementById('codeValue').value.trim();
  if(!sellerId) return alert('sellerId required');
  if(!code) code = Math.floor(10000 + Math.random()*89999).toString();
  await db.collection('entryCodes').add({ sellerId, code, createdAt: new Date().toISOString() });
  loadCodes();
};

async function loadCodes(){
  const tbody = document.querySelector('#codesTable tbody');
  tbody.innerHTML = '';
  const snap = await db.collection('entryCodes').orderBy('createdAt','desc').get();
  snap.forEach(d=>{
    const r = d.data();
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.code}</td><td>${r.sellerId}</td><td>${r.createdAt}</td><td><button data-id="${d.id}" class="del">Delete</button></td>`;
    tbody.appendChild(tr);
  });
  document.querySelectorAll('.del').forEach(b=>b.onclick = async (e)=>{ if(confirm('Delete?')){ await db.collection('entryCodes').doc(e.target.dataset.id).delete(); loadCodes(); } });
}
</script>
</body>
</html>
